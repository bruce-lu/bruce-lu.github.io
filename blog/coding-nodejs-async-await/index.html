<!DOCTYPE html>
<html>
  <head>
  <title>
      
          Promise, async and await - Bruce Lu&#39;s pages
      
  </title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="author" content="map[]" />
  <link rel="shortcut icon" type="image/x-icon" href="https://bruce-lu.github.io/img/favicon.ico">

  
  
  
  
  
  <link rel="stylesheet" href="https://bruce-lu.github.io/style.min.658d6d6b74f1690b9919f17a04765dd9d4c57b29efded85728be2bacbe8b4bb1.css">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">

  
  

  <meta property="og:title" content="Promise, async and await" />
<meta property="og:description" content="Promise, async and await async function f() { try { let response = await fetch(&#39;/no-user-here&#39;); let user = await response.json(); } catch(err) { // catches errors both in fetch and response.json  alert(err); } } f(); // reference: https://javascript.info/async-await // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function A full html for demo and testing &lt;!DOCTYPE html&gt; &lt;html lang=&#34;en&#34;&gt; &lt;head&gt; &lt;meta charset=&#34;UTF-8&#34;&gt; &lt;meta name=&#34;viewport&#34; content=&#34;width=device-width, initial-scale=1.0&#34;&gt; &lt;title&gt;Demo of async await promise&lt;/title&gt; &lt;/head&gt; &lt;body&gt; Demo of async await promise &lt;script lang=&#34;javascript&#34;&gt; /* ## Promise The Promise object represents the eventual completion (or failure) of an asynchronous operation, and its resulting value." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bruce-lu.github.io/blog/coding-nodejs-async-await/" /><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2019-07-04T15:55:42+08:00" />
<meta property="article:modified_time" content="2019-07-04T15:55:42+08:00" />

<meta itemprop="name" content="Promise, async and await">
<meta itemprop="description" content="Promise, async and await async function f() { try { let response = await fetch(&#39;/no-user-here&#39;); let user = await response.json(); } catch(err) { // catches errors both in fetch and response.json  alert(err); } } f(); // reference: https://javascript.info/async-await // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function A full html for demo and testing &lt;!DOCTYPE html&gt; &lt;html lang=&#34;en&#34;&gt; &lt;head&gt; &lt;meta charset=&#34;UTF-8&#34;&gt; &lt;meta name=&#34;viewport&#34; content=&#34;width=device-width, initial-scale=1.0&#34;&gt; &lt;title&gt;Demo of async await promise&lt;/title&gt; &lt;/head&gt; &lt;body&gt; Demo of async await promise &lt;script lang=&#34;javascript&#34;&gt; /* ## Promise The Promise object represents the eventual completion (or failure) of an asynchronous operation, and its resulting value."><meta itemprop="datePublished" content="2019-07-04T15:55:42+08:00" />
<meta itemprop="dateModified" content="2019-07-04T15:55:42+08:00" />
<meta itemprop="wordCount" content="578">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Promise, async and await"/>
<meta name="twitter:description" content="Promise, async and await async function f() { try { let response = await fetch(&#39;/no-user-here&#39;); let user = await response.json(); } catch(err) { // catches errors both in fetch and response.json  alert(err); } } f(); // reference: https://javascript.info/async-await // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function A full html for demo and testing &lt;!DOCTYPE html&gt; &lt;html lang=&#34;en&#34;&gt; &lt;head&gt; &lt;meta charset=&#34;UTF-8&#34;&gt; &lt;meta name=&#34;viewport&#34; content=&#34;width=device-width, initial-scale=1.0&#34;&gt; &lt;title&gt;Demo of async await promise&lt;/title&gt; &lt;/head&gt; &lt;body&gt; Demo of async await promise &lt;script lang=&#34;javascript&#34;&gt; /* ## Promise The Promise object represents the eventual completion (or failure) of an asynchronous operation, and its resulting value."/>

  <!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
  <![endif]-->

  <!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
  <![endif]-->

  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-124907735-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
</head>

  <body>
    
  <h1>Promise, async and await</h1>
  <header>
  
  <div class="avatar">
    <img class="avatarMask" src="https://bruce-lu.github.io//img/avatar.jpg">
    <a href="https://bruce-lu.github.io/"><img src="https://bruce-lu.github.io//img/avatar-border.svg" }}></a>
  </div>
  
  <h2><a class="author" href="https://bruce-lu.github.io/">Bruce Lu</a></h2>
</header>

  
  
  <p class="date">July 4, 2019</p>
  
  <div id="contentBody">
    <h2 id="promise-async-and-await">Promise, async and await</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Javascript" data-lang="Javascript"><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">f</span>() {

  <span style="color:#66d9ef">try</span> {
    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">response</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">fetch</span>(<span style="color:#e6db74">&#39;/no-user-here&#39;</span>);
    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">user</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">json</span>();
  } <span style="color:#66d9ef">catch</span>(<span style="color:#a6e22e">err</span>) {
    <span style="color:#75715e">// catches errors both in fetch and response.json
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">alert</span>(<span style="color:#a6e22e">err</span>);
  }
}

<span style="color:#a6e22e">f</span>();

<span style="color:#75715e">// reference: https://javascript.info/async-await
</span><span style="color:#75715e">// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function
</span></code></pre></div><h2 id="a-full-html-for-demo-and-testing">A full html for demo and testing</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-HTML" data-lang="HTML">
<span style="color:#75715e">&lt;!DOCTYPE html&gt;</span>
&lt;<span style="color:#f92672">html</span> <span style="color:#a6e22e">lang</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;en&#34;</span>&gt;

&lt;<span style="color:#f92672">head</span>&gt;
  &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">charset</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span>&gt;
  &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;viewport&#34;</span> <span style="color:#a6e22e">content</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;width=device-width, initial-scale=1.0&#34;</span>&gt;
  &lt;<span style="color:#f92672">title</span>&gt;Demo of async await promise&lt;/<span style="color:#f92672">title</span>&gt;
&lt;/<span style="color:#f92672">head</span>&gt;

&lt;<span style="color:#f92672">body</span>&gt;
  Demo of async await promise

  &lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">lang</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;javascript&#34;</span>&gt;

    <span style="color:#75715e">/*
</span><span style="color:#75715e">      ## Promise
</span><span style="color:#75715e">        The Promise object represents the eventual completion (or failure) of an asynchronous operation, and 
</span><span style="color:#75715e">        its resulting value.
</span><span style="color:#75715e">        A Promise is a proxy for a value not necessarily known when the promise is created. It allows you 
</span><span style="color:#75715e">        to associate handlers with an asynchronous action&#39;s eventual success value or failure reason. This 
</span><span style="color:#75715e">        lets asynchronous methods return values like synchronous methods: instead of immediately returning 
</span><span style="color:#75715e">        the final value, the asynchronous method returns a promise to supply the value at some point in the future.
</span><span style="color:#75715e">
</span><span style="color:#75715e">        A Promise is in one of these states:
</span><span style="color:#75715e">        pending: initial state, neither fulfilled nor rejected.
</span><span style="color:#75715e">        fulfilled: meaning that the operation completed successfully.
</span><span style="color:#75715e">        rejected: meaning that the operation failed.
</span><span style="color:#75715e">
</span><span style="color:#75715e">        A pending promise can either be fulfilled with a value, or rejected with a reason (error). 
</span><span style="color:#75715e">        When either of these options happens, the associated handlers queued up by a promise&#39;s then method 
</span><span style="color:#75715e">        are called. (If the promise has already been fulfilled or rejected when a corresponding handler is 
</span><span style="color:#75715e">        attached, the handler will be called, so there is no race condition between an asynchronous operation 
</span><span style="color:#75715e">        completing and its handlers being attached.)
</span><span style="color:#75715e">
</span><span style="color:#75715e">        It has then, catch and finally methods.
</span><span style="color:#75715e">
</span><span style="color:#75715e">        My understanding: Promise resolved the problem of callback hell. It allows you to associate/attach 
</span><span style="color:#75715e">        handlers instead of treat them as function parameters. 
</span><span style="color:#75715e">          loadScript(src, callback1, callback2, callback3);
</span><span style="color:#75715e">          loadSomething(src).then(callback1)
</span><span style="color:#75715e">                            .then(callback2)
</span><span style="color:#75715e">                            .then(callback3);
</span><span style="color:#75715e">
</span><span style="color:#75715e">      ## async, await (a -&gt; asynchronous)
</span><span style="color:#75715e">        async keyword, which you put in front of a function declaration to turn it into an async function. 
</span><span style="color:#75715e">        An async function is a function which knows how to expect the possibility of the await keyword being 
</span><span style="color:#75715e">        used to invoke asynchronous code.
</span><span style="color:#75715e">
</span><span style="color:#75715e">        The real advantage of async functions becomes apparent when you combine it with the await keyword. 
</span><span style="color:#75715e">        This can be put in front of any async promise-based function to pause your code on that line until 
</span><span style="color:#75715e">        the promise fulfills, then return the resulting value. In the meantime, other code that may be 
</span><span style="color:#75715e">        waiting for a chance to execute gets to do so.
</span><span style="color:#75715e">
</span><span style="color:#75715e">        You can use await when calling any function that returns a Promise, including web API functions.
</span><span style="color:#75715e">
</span><span style="color:#75715e">        async myFetch(url){
</span><span style="color:#75715e">          let res = await fetch(url);
</span><span style="color:#75715e">        }
</span><span style="color:#75715e">
</span><span style="color:#75715e">        The return value of async function is a Promise, you can call then on it.
</span><span style="color:#75715e">
</span><span style="color:#75715e">        My understanding: async &amp; await make writing async code like sync code, easier to read &amp; maintain.
</span><span style="color:#75715e">
</span><span style="color:#75715e">      ## Ref
</span><span style="color:#75715e">      [Async_await](https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Asynchronous/Async_await)
</span><span style="color:#75715e">      [js info](https://javascript.info/async)
</span><span style="color:#75715e">    */</span>

    <span style="color:#75715e">// async await demo
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">fun</span>() {
      <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
      <span style="color:#75715e">// await can be put in front of any async promise-based function to pause your code on that 
</span><span style="color:#75715e"></span>      <span style="color:#75715e">// line until the promise fulfills, then return the resulting value. 
</span><span style="color:#75715e"></span>      <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#66d9ef">new</span> Promise((<span style="color:#a6e22e">resolve</span>, <span style="color:#a6e22e">reject</span>)=&gt;{
        <span style="color:#75715e">//setTimeout(() =&gt;{console.log(&#39;in promise&#39;);}, 1000);
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// To simulate a delay
</span><span style="color:#75715e"></span>        <span style="color:#a6e22e">setTimeout</span>(() =&gt;{<span style="color:#a6e22e">resolve</span>(<span style="color:#e6db74">&#39;Resolved&#39;</span>); <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;in promise&#39;</span>);}, <span style="color:#ae81ff">1000</span>);
      
      });
      <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;res: &#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">res</span>);
      <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">res</span>;
    }
    
    <span style="color:#75715e">// promise demo
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">myPromise</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Promise((<span style="color:#a6e22e">resolve</span>, <span style="color:#a6e22e">reject</span>)=&gt;{
      <span style="color:#75715e">// use setTimeout to simulate some async time consuming work
</span><span style="color:#75715e"></span>      <span style="color:#a6e22e">setTimeout</span>(() =&gt; <span style="color:#a6e22e">resolve</span>(<span style="color:#e6db74">&#34;Done myPromise!&#34;</span>),<span style="color:#ae81ff">3000</span>);
    });

    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;start..&#34;</span>);
    <span style="color:#a6e22e">myPromise</span>.<span style="color:#a6e22e">then</span>(<span style="color:#a6e22e">data</span> =&gt; {<span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">data</span>)});
    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">fun</span>());
    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;end.&#34;</span>);

    <span style="color:#75715e">/* Output may look like:
</span><span style="color:#75715e">
</span><span style="color:#75715e">      start..
</span><span style="color:#75715e">      Promise {&lt;pending&gt;}
</span><span style="color:#75715e">      end.
</span><span style="color:#75715e">      in promise
</span><span style="color:#75715e">      res: Resolved
</span><span style="color:#75715e">      Done myPromise!
</span><span style="color:#75715e">
</span><span style="color:#75715e">    */</span>
    
  &lt;/<span style="color:#f92672">script</span>&gt;
&lt;/<span style="color:#f92672">body</span>&gt;

&lt;/<span style="color:#f92672">html</span>&gt;

</code></pre></div>
  </div>
  <footer>
  <p>
  &copy; 2020 Bruce Lu.
  Powered by <a href="https://gohugo.io/">Hugo</a>
  using the <a href="https://github.com/koirand/pulp/">pulp</a> theme.
  </p>
</footer>


  </body>
</html>
